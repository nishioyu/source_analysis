【CRUD分析処理】

<input>
文字列形式
SQL文(一トランザクション単位)

<output>
標準出力
CRUD、テーブル、テーブル名、カラム名

<メイン処理>
1 SQLを各サブクエリごとに辞書に格納、キーは数字で前から順に番号を裁判することとする（サブクエリ抽出処理）
2 SQLのサブクエリ辞書ごとにCRUD処理を回す。（CRUD抽出処理）
3 3処理の結果を順に出力する

【エイリアス処理】

<input>
文字列形式
SQL文(一トランザクション単位)

<output>
文字列形式
SQL文(一トランザクション単位)

<メイン処理>
1 SQL文の中で"()"で囲まれている&中に"()"を含まない&中にSELECT,...等の文字列を含む箇所を特定する。
2 1で特定した箇所の末尾に末尾にエイリアスをつける

【サブクエリ抽出処理】

<input>
文字列形式
SQL文(一トランザクション単位)

<output>
数字をキーとした辞書

<メイン処理>
1 SQL文の中で"()"で囲まれている&中に"()"を含まない&中にSELECT,...等の文字列を含む箇所を特定する。
2 1で特定した箇所の末尾に末尾にエイリアスをつける


【CRUD抽出処理】
xxxx



--------------------------------------------------


【CRUD抽出処理メモ】
前提：サブクエリは全てREAD

<SELECT>
 xxxx
 
<INSERT>
 INSERT INTO テーブル名 カラム名は要検討

<UPDATE>
 UPDATE テーブル名　カラム名は SET column = value の形式

<DELETE>
 DELETDELETE FROM テーブル名　カラム名はテーブル定義から取得 




【サブクエリ抽出処理】




【その他メモ】
本質的には以下の処理になる。

SQLファイル抽出処理

埋め込みSQL抽出処理

サブクエリ抽出処理

SELECTのCRUD抽出処理

その他CUDのCRUD出力処理




CRUD抽出処理(入力クエリ)
    crud_flg = 最外部のCRUD判定処理(入力クエリ)→戻り値はC,R,U,D
    if crud_flg == R:
        R_CRUD抽出処理(入力クエリ):
    else:
        CUD_CRUD抽出処理(入力クエリ):



最外部のCRUD判定処理(入力クエリ):
できてそう！


R_CRUD抽出処理(入力クエリ):→サブクエリも含んで再帰的に処理する


CUD_CRUD抽出処理(入力クエリ):→
    最外部のCRUD表作成処理
    サブクエリ一覧抽出処理
    R_CRUD抽出処理（サブクエリ）


サブクエリ一覧抽出処理(入力クエリ)：→戻り値を考える



list = {}
SELCT *** FROM ... (SELECT ****)

{TBL1:(SELECT ****)}を追加
(SELECT ****)を文字に置換TBL1

SELCT *** FROM ... TBL1



(SELECT カラム名　FROM テーブル名 ),TBL1,エイリアス
(SELECT カラム名　FROM テーブル名 ),TBL2,エイリアス
(SELECT カラム名　FROM テーブル名 ),TBL3,エイリアス
(SELECT カラム名　FROM テーブル名 ),TBL4,エイリアス


入力SQLのルール
サブクエリには全てエイリアスがついている
複数テーブルの結合がある場合には全てカラム名の前に.でエイリアスor本テーブル名がついている
テーブル（仮想）のエイリアスと実体テーブル名は重複がないものとする
SELECT文の解析については実体のあるテーブルでSELECTしたカラムもしくは、結合に用いた結合条件のカラムを利用したとする




出力結果の制約
実体のないテーブルへの操作は無視するとする



 SELECT T.カラム1,AVG(T.hoge),B.fuga
 FROM (SELCT カラム2+カラム3 AS カラム1,カラム4-カラム5 AS hoge ...FROM　実体テーブルA...) AS T,実体のあるテーブルB 
 WHERE 結合...

実体テーブルA カラム2,カラム3,カラム4,カラム5
実体テーブルB 

知るべき知識は
SQLのに対してどのカラムへのアクセスがあるか？

SELECTはテーブルを対象(全件対象)

            テーブル1_カラム1  テーブル2＿カラム1  テーブル2_カラム2 　テーブル3＿カラム1  テーブル3_カラム2
プログラム1         U                                                   R               R(SQLによらず)
プログラム2                         R                  R(SQLによらず)
プログラム3





SELECT
カラム名

FROM
テーブル名,
テーブル名,
...

JOIN ON
テーブル名

